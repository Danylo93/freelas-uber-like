datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum UserRole {
  CUSTOMER
  PROVIDER
  ADMIN
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  role      UserRole
  phone     String?
  createdAt DateTime @default(now())

  // Relations
  providerProfile ProviderProfile?
  requests        ServiceRequest[]
  jobs            Job[]
  offers          Offer[]
}

model ProviderProfile {
  id             String   @id @default(uuid())
  userId         String   @unique
  user           User     @relation(fields: [userId], references: [id])
  isOnline       Boolean  @default(false)
  specialties    String[] // Category IDs
  docsStatus     String   @default("PENDING")
  rating         Float    @default(0)
  completedJobs  Int      @default(0)

  currentLat     Float?
  currentLng     Float?
}

model ServiceCategory {
  id       String @id @default(uuid())
  name     String
  icon     String
  services Service[]
}

model Service {
  id          String   @id @default(uuid())
  categoryId  String
  category    ServiceCategory @relation(fields: [categoryId], references: [id])
  name        String
}

enum RequestStatus {
  PENDING
  OFFERED
  ACCEPTED
  CANCELED
  EXPIRED
}

enum OfferStatus {
  PENDING
  ACCEPTED
  REJECTED
}

model ServiceRequest {
  id          String   @id @default(uuid())
  customerId  String
  customer    User     @relation(fields: [customerId], references: [id])
  categoryId  String
  description String
  price       Float?
  status      RequestStatus @default(PENDING)
  pickupLat   Float
  pickupLng   Float
  address     String?
  createdAt   DateTime @default(now())

  job         Job?
  offers      Offer[]
}

model Offer {
  id            String   @id @default(uuid())
  requestId     String
  request       ServiceRequest @relation(fields: [requestId], references: [id])
  providerId    String
  provider      User     @relation(fields: [providerId], references: [id])
  proposedPrice Float
  message       String?
  status        OfferStatus @default(PENDING)
  createdAt     DateTime @default(now())
}

enum JobStatus {
  ACCEPTED
  ON_THE_WAY
  ARRIVED
  STARTED
  COMPLETED
  CANCELED
}

model Job {
  id          String   @id @default(uuid())
  requestId   String   @unique
  request     ServiceRequest @relation(fields: [requestId], references: [id])
  providerId  String
  provider    User     @relation(fields: [providerId], references: [id])
  status      JobStatus @default(ACCEPTED)
  startedAt   DateTime?
  completedAt DateTime?

  reviews     Review[]
  locationHistory LocationPing[]
}

model LocationPing {
  id          String   @id @default(uuid())
  jobId       String
  job         Job      @relation(fields: [jobId], references: [id])
  providerId  String
  lat         Float
  lng         Float
  timestamp   DateTime @default(now())
}

model Review {
  id          String   @id @default(uuid())
  jobId       String
  job         Job      @relation(fields: [jobId], references: [id])
  rating      Int
  comment     String?
  tags        String[]
}
